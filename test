<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i C·∫≠u ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- 1. C·∫§U H√åNH & RESET --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            height: 100vh;
            background: linear-gradient(182deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            position: relative;
            user-select: none;
        }

        /* --- 2. BACKGROUND CANVAS --- */
        #main-canvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }

        /* --- 3. MARQUEE (CH·ªÆ CH·∫†Y) --- */
        .marquee-container {
            position: absolute; top: 20px; width: 100%;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(2px);
            padding: 8px 0; overflow: hidden; z-index: 20;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .marquee-text {
            white-space: nowrap; display: inline-block;
            color: #d63384; font-family: 'Dancing Script', cursive;
            font-size: 1.4rem; font-weight: bold;
            animation: scroll 15s linear infinite;
        }
        @keyframes scroll { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }

        /* --- 4. C√ÅC M√ÄN H√åNH (SCREENS) --- */
        .container {
            position: relative; z-index: 10;
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            perspective: 1000px;
        }

        .screen {
            position: absolute;
            width: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .screen.active {
            opacity: 1; pointer-events: auto;
            transform: scale(1) translateY(0);
        }

        /* SCREEN 1: H·ªòP QU√Ä */
        .gift-box {
            font-size: 6rem; cursor: pointer;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1));
            animation: float 2.5s ease-in-out infinite;
            transition: transform 0.2s;
        }
        .gift-box:active { transform: scale(0.9); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* SCREEN 2: C√ÇU H·ªéI */
        .card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px 20px; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center; width: 90%; max-width: 420px;
        }
        .card h1 {
            color: #ff4757; font-family: 'Dancing Script', cursive;
            font-size: 2.5rem; margin-bottom: 25px; margin-top: 0;
        }
        .btn-group { display: flex; gap: 15px; justify-content: center; align-items: center; }
        .btn {
            padding: 12px 30px; font-size: 1.1rem; border: none; border-radius: 50px;
            cursor: pointer; font-weight: 800; transition: all 0.2s; outline: none;
        }
        .btn-yes { background: #ff4757; color: white; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        .btn-yes:active { transform: scale(0.95); }
        .btn-no { background: #dfe6e9; color: #636e72; position: relative; transition: transform 0.2s ease; }

        /* SCREEN 3: K·∫æT QU·∫¢ */
        .result-img {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;
        }
        .result-img img {
            width: 45%; height: 160px; object-fit: cover; border-radius: 12px;
            border: 4px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: rotate(-5deg);
        }
        .result-img img:last-child { transform: rotate(5deg); }
        
        /* POPUP SAD */
        #sad-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(3px);
        }
        .sad-modal {
            background: white; padding: 25px; border-radius: 20px;
            text-align: center; width: 85%; max-width: 300px;
            animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .sad-modal img { width: 140px; margin-bottom: 10px; border-radius: 10px; }

    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="https://data.chiasenhac.com/down/2265/5/2264104-e3c79da3/128/I%20Do%20-%20911.mp3" type="audio/mp3">
    </audio>

    <canvas id="main-canvas"></canvas>

    <div class="marquee-container">
        <div class="marquee-text">
            Ch√†o ng∆∞·ªùi ƒë·∫πp nh·∫•t th·∫ø gian! ‚ù§Ô∏è Ch√∫c c·∫≠u m·ªôt ng√†y th·∫≠t vui v·∫ª nh√©! ƒê·ª´ng qu√™n c∆∞·ªùi nhi·ªÅu h∆°n nha üåπ Y√™u c·∫≠u 3000!
        </div>
    </div>

    <div class="container">
        <div id="screen-1" class="screen active">
            <div class="gift-box" onclick="openGift()">üéÅ</div>
            <p style="color: #fff; font-weight: bold; margin-top: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">M·ªü qu√† ƒëi n√†o!</p>
        </div>

        <div id="screen-2" class="screen">
            <div class="card">
                <h1>L√†m ng∆∞·ªùi y√™u t·ªõ nha? ‚ù§Ô∏è</h1>
                <div class="btn-group">
                    <button id="btn-yes" class="btn btn-yes" onclick="finishLove()">Okii lun! üòΩ</button>
                    <button id="btn-no" class="btn btn-no" onclick="rejectLove()" onmouseover="moveBtn(this)" ontouchstart="moveBtn(this)">Kh√¥ng üòú</button>
                </div>
            </div>
        </div>

        <div id="screen-3" class="screen">
            <div class="card" style="background: rgba(255,255,255,0.95);">
                <div class="result-img">
                    <img src="https://i.pinimg.com/564x/f3/d3/18/f3d318391277a0640df175965b262d08.jpg" alt="·∫¢nh 1">
                    <img src="https://i.pinimg.com/564x/16/00/c7/1600c73e045a1651817105d15c7e1488.jpg" alt="·∫¢nh 2">
                </div>
                <h2 style="color: #ff4757; font-family: 'Dancing Script'; font-size: 2.2rem; margin: 5px 0;">Y√™u c·∫≠u nh·∫Øm! ‚ù§Ô∏è</h2>
                <p style="color: #555; line-height: 1.5;">
                    C·∫£m ∆°n c·∫≠u ƒë√£ ƒë·ªìng √Ω.<br>
                    T·ªõ h·ª©a s·∫Ω ngoan v√† nghe l·ªùi.<br>
                    Nh·∫Øn tin cho t·ªõ ƒëi! üíë
                </p>
            </div>
        </div>
    </div>

    <div id="sad-overlay">
        <div class="sad-modal">
            <img src="https://media.giphy.com/media/OPU6wzx8JrHna/giphy.gif" alt="Sad Cat">
            <h3 style="color: #ff4757; margin: 0 0 10px;">ƒê·ª´ng m√†... üò≠</h3>
            <p style="font-size: 0.9rem; color: #555; margin-bottom: 15px;">Th·ª≠ l·∫°i l·∫ßn n·ªØa ƒëi!</p>
            <button class="btn btn-yes" onclick="closeSad()">Ch·ªçn l·∫°i</button>
        </div>
    </div>

    <script>
        /* ==================== PH·∫¶N 1: LOGIC CANVAS ==================== */
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class FloatingHeart {
            constructor() { this.reset(true); }
            reset(init = false) {
                this.x = Math.random() * width;
                this.y = init ? Math.random() * height : height + 20;
                this.size = Math.random() * 15 + 5;
                this.speed = Math.random() * 1.5 + 0.5;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.y -= this.speed;
                if(this.y < -30) this.reset();
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.font = `${this.size}px Arial`;
                ctx.fillText('‚ù§Ô∏è', this.x, this.y);
            }
        }
        const hearts = Array.from({length: 40}, () => new FloatingHeart());

        let bigHeartParticles = [];
        let isFinalState = false;

        function getHeartPoint(t) {
            return {
                x: 16 * Math.pow(Math.sin(t), 3),
                y: -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t))
            };
        }

        class BigHeartParticle {
            constructor(t) {
                const pos = getHeartPoint(t);
                this.scale = (Math.min(width, height) / 40); 
                this.baseX = width/2 + pos.x * this.scale;
                this.baseY = height/2 + pos.y * this.scale;
                this.x = this.baseX; this.y = this.baseY;
                this.size = Math.random() * 2 + 1;
                this.color = '#ff4757';
            }
            update() {
                const beat = 1 + Math.sin(Date.now() * 0.005) * 0.05;
                this.x = width/2 + (this.baseX - width/2) * beat;
                this.y = height/2 + (this.baseY - height/2) * beat;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            hearts.forEach(h => { h.update(); h.draw(); });
            if(isFinalState) {
                bigHeartParticles.forEach(p => { p.update(); p.draw(); });
            }
            requestAnimationFrame(animate);
        }
        animate();

        /* ==================== PH·∫¶N 2: LOGIC GIAO DI·ªÜN & NH·∫†C ==================== */
        let countNo = 0;

        // H√†m m·ªü qu√† + Ph√°t nh·∫°c
        function openGift() {
            // 1. Chuy·ªÉn m√†n h√¨nh
            document.getElementById('screen-1').classList.remove('active');
            document.getElementById('screen-2').classList.add('active');
            
            // 2. Ph√°t nh·∫°c
            const audio = document.getElementById('bg-music');
            audio.play().catch(function(error) {
                console.log("Tr√¨nh duy·ªát ch·∫∑n autoplay, c·∫ßn t∆∞∆°ng t√°c th√™m.");
            });
        }

        function nextScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${id}`).classList.add('active');
        }

        function rejectLove() {
            countNo++;
            document.getElementById('sad-overlay').style.display = 'flex';
        }

        // Logic n√∫t Kh√¥ng ch·∫°y tr·ªën (L·∫ßn th·ª© 3 m·ªõi ch·∫°y)
        function moveBtn(btn) {
            if (countNo >= 3) {
                const maxX = 150;
                const maxY = 150;
                const x = (Math.random() - 0.5) * maxX * 2;
                const y = (Math.random() - 0.5) * maxY * 2;
                btn.style.transform = `translate(${x}px, ${y}px)`;
            }
        }

        function closeSad() {
            document.getElementById('sad-overlay').style.display = 'none';
            const btnYes = document.getElementById('btn-yes');
            const btnNo = document.getElementById('btn-no');
            
            // TƒÉng k√≠ch th∆∞·ªõc n√∫t Yes
            let currentPad = parseInt(window.getComputedStyle(btnYes).paddingTop);
            btnYes.style.padding = `${currentPad + 5}px ${currentPad * 3}px`;
            btnYes.style.fontSize = `${1.1 + (countNo * 0.1)}rem`;
            
            const texts = ["Th√¥i m√†... ü•∫", "ƒêi m·ªù... ü•∫", "ƒê·ª´ng m√†... üò≠", "Y√äU ƒêI M√Ä!!"];
            btnYes.innerText = texts[Math.min(countNo-1, 3)] || "Y√äU ƒêI M√Ä!!";

            if (countNo >= 3) {
                btnNo.innerText = "H·∫øt c·ª≠a r√πi üòú";
            }
        }

        function finishLove() {
            document.getElementById('screen-2').classList.remove('active');
            document.getElementById('screen-3').classList.add('active');
            
            isFinalState = true;
            for(let i=0; i<250; i++) {
                bigHeartParticles.push(new BigHeartParticle(Math.random() * Math.PI * 2));
            }
            fireConfetti();
        }

        function fireConfetti() {
            const colors = ['#ff7675', '#74b9ff', '#55efc4', '#ffeaa7', '#e84393'];
            for(let i=0; i<50; i++) {
                const el = document.createElement('div');
                el.style.position = 'fixed';
                el.style.left = '50%'; el.style.top = '50%';
                el.style.width = '8px'; el.style.height = '8px';
                el.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                el.style.borderRadius = '50%';
                el.style.zIndex = '999';
                document.body.appendChild(el);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 200 + 100;
                
                const anim = el.animate([
                    { transform: 'translate(0,0) scale(1)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px) scale(0)`, opacity: 0 }
                ], { 
                    duration: Math.random() * 500 + 500, 
                    easing: 'cubic-bezier(0.25, 1, 0.5, 1)' 
                });
                anim.onfinish = () => el.remove();
            }
        }
    </script>
</body>
</html>
